# `network/` 目录最终结构与规范

**文档目的:** 本文档旨在最终确定 `Labbook` 规范中 `network/` 目录的构成。该目录负责完整、精确地定义实验开始前的静态初始网络环境。

## 1. 核心设计

`network/` 目录的设计遵循**关注点分离**的原则，将网络的**逻辑蓝图**与其所需的**挂载内容**清晰地分开。它由以下两部分构成：

1. 一个核心的**拓扑定义文件**。
2. 一个用于存放所有**待挂载内容**的源目录。

## 2. 最终目录结构

```
network/
│
├── config.yaml         # [必需] 网络的“蓝图”文件
│
└── mounts/               # [可选] 存放所有待挂载内容的“源目录”
    │
    ├── [node-id-1]/      # 以节点ID命名的子目录
    │   │
    │   └── etc/          # 将被挂载到容器 /etc/ 目录下的内容
    │       └── nginx/
    │           └── nginx.conf
    │
    └── [node-id-2]/
        │
        └── var/
            └── www/
                └── index.html

```

## 3. 组件职责详解

### 3.1. `config.yaml` (拓扑蓝图)

这是 `network/` 目录中最重要的文件，是我们之前所有讨论的最终成果。

- **命名决策:** 我们最终确定使用 `config.yaml` 作为文件名，因为它最能精确、专业地描述该文件的核心用途——定义网络的拓扑结构、节点能力和连接关系。
- **核心职责:**
    - 通过 `images` 字段，管理所有容器镜像的来源。
    - 通过 `nodes` 字段，定义所有计算节点，并精确声明其每个网络接口的 `mode` (工作模式)。
    - 通过 `switches` 字段，显式定义所有L2广播域（虚拟交换机）。
    - 通过 `links` 字段，基于接口的 `mode`，以一种清晰、无歧义的方式定义所有点对点和交换式连接。
    - 通过 `nodes` 中的 `volumes` 字段，声明需要从 `mounts/` 目录中挂载哪些内容到节点内部。

### 3.2. `mounts/` (挂载源目录)

这是一个可选目录，但对于绝大多数需要自定义配置的实验来说，它是必不可少的。

- **核心职责:** 存放所有需要被注入到节点容器中的文件和目录。它是 `config.yaml` 中 `volumes` 字段所引用的内容的**物理源位置**。
- **工作机制 (约定优于配置):**
    - `mounts/` 的直接子目录，其名称必须与 `config.yaml` 中定义的**节点ID**完全对应。
    - 执行引擎在创建节点时，会将在 `config.yaml` 的 `volumes` 字段中声明的 `source` 路径，从对应的 `mounts/[节点ID]/` 子目录中找到，并挂载到指定的 `destination` 位置。

## 4. 结论

这个最终的 `network/` 目录结构，通过 `config.yaml` 和 `mounts/` 的清晰分工，完美地实现了将**“是什么”（逻辑蓝图）**和**“有什么”（具体内容）**的分离。它既保证了规范的严谨性和可扩展性，又为研究者提供了直观、易于管理的配置体验。